/* ./decoder/correlator.c */
static void                     set_patterns(lrpt_decoder_correlator_t *corr, uint8_t n, uint64_t p);
static uint8_t                  rotate_iq(const lrpt_decoder_correlator_t *corr, uint8_t data, uint8_t shift);
static uint64_t                 rotate_iq_qw(const lrpt_decoder_correlator_t *corr, uint64_t data, uint8_t shift);
static uint64_t                 flip_iq_qw(const lrpt_decoder_correlator_t *corr, uint64_t data);
lrpt_decoder_correlator_t *     lrpt_decoder_correlator_init(void);
void                            lrpt_decoder_correlator_deinit(lrpt_decoder_correlator_t *corr);
uint8_t                         lrpt_decoder_correlator_correlate(lrpt_decoder_correlator_t *corr, const int8_t *data, size_t len);

/* ./decoder/data.c */
static void                     fix_packet(int8_t *data, uint8_t shift);
static void                     do_next_correlate(lrpt_decoder_t *decoder, int8_t *data);
static void                     do_full_correlate(lrpt_decoder_t *decoder, int8_t *data);
static bool                     decode_frame(lrpt_decoder_t *decoder);
bool                            lrpt_decoder_data_process_frame(lrpt_decoder_t *decoder, int8_t *data);

/* ./decoder/decoder.c */
lrpt_decoder_t *                lrpt_decoder_init(lrpt_decoder_spacecraft_t sc);
void                            lrpt_decoder_deinit(lrpt_decoder_t *decoder);
void                            lrpt_decoder_exec(lrpt_decoder_t *decoder, lrpt_qpsk_data_t *input, size_t buf_len);

/* ./decoder/ecc.c */
void                            lrpt_decoder_ecc_interleave(const uint8_t *input, uint8_t *output, uint8_t pos, uint8_t n);
void                            lrpt_decoder_ecc_deinterleave(const uint8_t *input, uint8_t *output, uint8_t pos, uint8_t n);
bool                            lrpt_decoder_ecc_decode(uint8_t *data, uint8_t pad);

/* ./decoder/huffman.c */
static int32_t                  get_ac_real(const lrpt_decoder_huffman_t *huff, uint16_t w);
static int32_t                  get_dc_real(uint16_t w);
lrpt_decoder_huffman_t *        lrpt_decoder_huffman_init(void);
void                            lrpt_decoder_huffman_deinit(lrpt_decoder_huffman_t *huff);
int32_t                         lrpt_decoder_huffman_get_ac(const lrpt_decoder_huffman_t *huff, uint16_t w);
int32_t                         lrpt_decoder_huffman_get_dc(const lrpt_decoder_huffman_t *huff, uint16_t w);
int32_t                         lrpt_decoder_huffman_map_range(uint8_t cat, uint16_t val);

/* ./decoder/jpeg.c */
static void                     flt_idct_8x8(lrpt_decoder_jpeg_t *jpeg, double *res, const int32_t *in);
static void                     fill_dqt_by_q(uint16_t *dqt, uint8_t q);
static bool                     progress_image(lrpt_decoder_t *decoder, uint16_t apid, uint8_t mcu_id, uint16_t pck_cnt);
static void                     fill_pix(lrpt_decoder_t *decoder, double *img_dct, uint16_t apid, uint8_t mcu_id, uint8_t m);
lrpt_decoder_jpeg_t *           lrpt_decoder_jpeg_init(void);
void                            lrpt_decoder_jpeg_deinit(lrpt_decoder_jpeg_t *jpeg);
bool                            lrpt_decoder_jpeg_decode_mcus(lrpt_decoder_t *decoder, uint8_t *p, uint16_t apid, uint16_t pck_cnt, uint8_t mcu_id, uint8_t q);

/* ./decoder/packet.c */
static void                     parse_70(lrpt_decoder_t *decoder, uint8_t *p);
static void                     parse_img(lrpt_decoder_t *decoder, uint8_t *p, uint16_t apid, uint16_t pck_cnt);
static void                     parse_apid(lrpt_decoder_t *decoder, uint8_t *p);
static uint16_t                 parse_partial(lrpt_decoder_t *decoder, uint8_t *p, uint16_t len);
void                            lrpt_decoder_packet_parse_cvcdu(lrpt_decoder_t *decoder);

/* ./decoder/viterbi.c */
static uint16_t                 metric_soft_distance(uint8_t hard, uint8_t soft_y0, uint8_t soft_y1);
static inline                   void swap_error_buffers(lrpt_decoder_viterbi_t *vit);
static void                     fill_pair_lookup_dists(lrpt_decoder_viterbi_t *vit);
static uint8_t                  history_buffer_search(const lrpt_decoder_viterbi_t *vit, uint8_t search_every);
static void                     history_buffer_renormalize(lrpt_decoder_viterbi_t *vit, uint8_t bestpath);
static void                     history_buffer_traceback(lrpt_decoder_viterbi_t *vit, uint8_t bestpath, uint8_t min_traceback_length);
static void                     history_buffer_process_skip(lrpt_decoder_viterbi_t *vit, uint8_t skip);
static void                     viterbi_inner(lrpt_decoder_viterbi_t *vit, const int8_t *input);
static void                     viterbi_tail(lrpt_decoder_viterbi_t *vit, const int8_t *input);
static void                     convolutional_decode(lrpt_decoder_viterbi_t *vit, const int8_t *input, uint8_t *output);
static void                     convolutional_encode(lrpt_decoder_viterbi_t *vit, uint8_t *input, uint8_t *output);
lrpt_decoder_viterbi_t *        lrpt_decoder_viterbi_init(void);
void                            lrpt_decoder_viterbi_deinit(lrpt_decoder_viterbi_t *vit);
void                            lrpt_decoder_viterbi_decode(lrpt_decoder_viterbi_t *vit, const lrpt_decoder_correlator_t *corr, const int8_t *input, uint8_t *output);
uint8_t                         lrpt_decoder_viterbi_ber_percent(const lrpt_decoder_viterbi_t *vit);
